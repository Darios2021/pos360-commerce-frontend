# nginx.conf  (se copia como /etc/nginx/conf.d/default.conf)

server {
  listen 80;
  server_name _;

  # Dist en root
  root /usr/share/nginx/html;
  index index.html;

  # Asegura mime types correctos (JS => application/javascript)
  include /etc/nginx/mime.types;
  default_type application/octet-stream;

  # Opcional: compresión (no es obligatorio)
  gzip on;
  gzip_types text/css application/javascript application/json image/svg+xml;
  gzip_min_length 512;

  # =========================
  # Redirects "limpios"
  # =========================
  location = / {
    return 302 /shop/;
  }
  location = /shop {
    return 301 /shop/;
  }

  # =========================
  # ✅ ASSETS: NUNCA devolver index.html
  # Si el asset no existe => 404 (así no rompe MIME)
  # =========================
  location ^~ /shop/assets/ {
    # Los assets viven en /usr/share/nginx/html/assets/*
    alias /usr/share/nginx/html/assets/;
    try_files $uri =404;

    add_header Cache-Control "public, max-age=31536000, immutable";
  }

  # Si por cualquier motivo se piden assets en /assets directo:
  location ^~ /assets/ {
    try_files $uri =404;
    add_header Cache-Control "public, max-age=31536000, immutable";
  }

  # =========================
  # ✅ SPA bajo /shop/
  # Cualquier ruta de vue => cae en index.html
  # =========================
  location ^~ /shop/ {
    alias /usr/share/nginx/html/;
    try_files $uri $uri/ /index.html;

    add_header Cache-Control "no-store";
  }
}
